<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HotTrack SAAS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0a0a0a; color: #e4e4e7; }
        .glass-card { background: rgba(23, 23, 23, 0.6); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .form-input { background-color: rgba(39, 39, 42, 0.5); border: 1px solid #3f3f46; color: #e4e4e7; transition: all 0.3s; }
        .form-input:focus { outline: none; border-color: #38bdf8; box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.3); }
        .btn { transition: all 0.3s ease; }
        .btn-primary { background-color: #0ea5e9; }
        .btn-primary:hover { background-color: #38bdf8; }
        .sidebar-item { border-left: 3px solid transparent; transition: all 0.2s; }
        .sidebar-item:hover { background-color: rgba(38, 38, 38, 0.5); border-left-color: #38bdf8; }
        .sidebar-item.active { background-color: rgba(14, 165, 233, 0.1); border-left-color: #0ea5e9; font-weight: 600; color: white; }
        .modal { display: none; }
        .modal.active { display: flex; }
    </style>
</head>
<body>
    <div id="app">
        </div>

    <script>
    const App = {
        // -----------------------------------------------------------------------------
        // ESTADO DA APLICAÇÃO
        // -----------------------------------------------------------------------------
        state: {
            API_BASE_URL: 'https://hottrack.vercel.app', // URL da sua API na Vercel
            token: null,
            user: null,
            data: {},
            currentPage: 'dashboard'
        },

        // -----------------------------------------------------------------------------
        // INICIALIZAÇÃO
        // -----------------------------------------------------------------------------
        async init() {
            this.state.token = localStorage.getItem('hottrack_token');
            if (this.state.token) {
                try {
                    this.state.data = await this.apiRequest('/api/dashboard/data');
                    this.render();
                } catch (e) {
                    this.logout();
                }
            } else {
                this.render();
            }
        },

        // -----------------------------------------------------------------------------
        // RENDERIZAÇÃO E TEMPLATES
        // -----------------------------------------------------------------------------
        render() {
            const appContainer = document.getElementById('app');
            if (!this.state.token) {
                appContainer.innerHTML = this.templates.auth();
            } else {
                appContainer.innerHTML = this.templates.layout();
                this.navigateTo(this.state.currentPage);
            }
            this.addEventListeners();
        },

        templates: {
            auth(page = 'login') {
                return `
                <div class="flex items-center justify-center min-h-screen p-4">
                    <div id="auth-forms-container" class="w-full max-w-md">
                        ${page === 'login' ? this.loginForm() : this.registerForm()}
                    </div>
                </div>`;
            },
            loginForm() {
                return `
                <div class="glass-card p-8 rounded-2xl shadow-2xl">
                    <h1 class="text-3xl font-bold text-center text-white">Acesse sua Conta</h1>
                    <form id="loginForm" class="space-y-6 mt-8">
                        <div><label class="text-sm font-medium text-gray-400">E-mail</label><input name="email" type="email" required class="form-input w-full p-3 mt-1 rounded-md"></div>
                        <div><label class="text-sm font-medium text-gray-400">Senha</label><input name="password" type="password" required class="form-input w-full p-3 mt-1 rounded-md"></div>
                        <button type="submit" class="btn btn-primary w-full text-white font-semibold py-3 rounded-md">Entrar</button>
                    </form>
                    <div class="text-center mt-6"><a href="#" id="showRegister" class="text-sm text-sky-400 hover:text-sky-300">Não tem uma conta? Cadastre-se</a></div>
                </div>`;
            },
            registerForm() {
                return `
                <div class="glass-card p-8 rounded-2xl shadow-2xl">
                    <h1 class="text-3xl font-bold text-center text-white">Crie sua Conta</h1>
                    <form id="registerForm" class="space-y-6 mt-8">
                        <div><label class="text-sm font-medium text-gray-400">Nome</label><input name="name" type="text" required class="form-input w-full p-3 mt-1 rounded-md"></div>
                        <div><label class="text-sm font-medium text-gray-400">E-mail</label><input name="email" type="email" required class="form-input w-full p-3 mt-1 rounded-md"></div>
                        <div><label class="text-sm font-medium text-gray-400">Senha</label><input name="password" type="password" required minlength="8" class="form-input w-full p-3 mt-1 rounded-md"></div>
                        <button type="submit" class="btn btn-primary w-full text-white font-semibold py-3 rounded-md">Criar Conta</button>
                    </form>
                    <div class="text-center mt-6"><a href="#" id="showLogin" class="text-sm text-sky-400 hover:text-sky-300">Já tem uma conta? Faça Login</a></div>
                </div>`;
            },
            layout() {
                return `
                <div class="flex h-screen">
                    <aside class="w-64 glass-card p-4 flex flex-col">
                        <div class="text-center mb-10"><h1 class="text-2xl font-bold text-white">HotTrack</h1></div>
                        <nav id="sidebarNav" class="flex flex-col space-y-2">
                            <a href="#" data-target="dashboard" class="sidebar-item p-3 rounded-lg flex items-center">Dashboard</a>
                            <a href="#" data-target="pressels" class="sidebar-item p-3 rounded-lg flex items-center">Pressels</a>
                            <a href="#" data-target="pixels" class="sidebar-item p-3 rounded-lg flex items-center">Pixels</a>
                            <a href="#" data-target="bots" class="sidebar-item p-3 rounded-lg flex items-center">Bots</a>
                            <a href="#" data-target="settings" class="sidebar-item p-3 rounded-lg flex items-center">API PIX</a>
                        </nav>
                        <div class="mt-auto"><button id="logoutButton" class="w-full bg-gray-700 hover:bg-red-600/50 text-white font-semibold py-2 px-4 rounded-md">Sair</button></div>
                    </aside>
                    <main id="content" class="flex-1 p-8 overflow-y-auto"></main>
                </div>`;
            },
            dashboard() {
                const stats = this.state.data.stats || {};
                const topStates = this.state.data.topStates || [];
                const topStatesHTML = topStates.length > 0 
                    ? topStates.map(item => `<div class="flex justify-between items-center text-gray-300 py-2 border-b border-gray-700/50 text-sm"><span>${item.state}</span><span class="font-semibold">${item.count} cliques</span></div>`).join('')
                    : '<p class="text-gray-500 text-sm">Nenhum dado disponível.</p>';
                return `
                <div>
                    <h1 class="text-3xl font-bold text-white mb-6">Visão Geral</h1>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="glass-card p-6 rounded-lg"><h3 class="text-gray-400">Cliques (30d)</h3><p class="text-4xl font-bold text-sky-400">${stats.clicks || 0}</p></div>
                        <div class="glass-card p-6 rounded-lg"><h3 class="text-gray-400">PIX Gerados (30d)</h3><p class="text-4xl font-bold text-amber-400">${stats.pix_generated || 0}</p></div>
                        <div class="glass-card p-6 rounded-lg"><h3 class="text-gray-400">PIX Pagos (30d)</h3><p class="text-4xl font-bold text-green-400">${stats.pix_paid || 0}</p></div>
                    </div>
                    <div class="mt-8 glass-card p-6 rounded-lg">
                        <h3 class="text-xl font-semibold text-white mb-4">Top Estados por Cliques</h3>
                        ${topStatesHTML}
                    </div>
                </div>`;
            },
            // Adicione aqui os templates para pixels, bots, pressels e settings...
        },

        // -----------------------------------------------------------------------------
        // EVENT LISTENERS
        // -----------------------------------------------------------------------------
        addEventListeners() {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const showRegister = document.getElementById('showRegister');
            const showLogin = document.getElementById('showLogin');
            const logoutButton = document.getElementById('logoutButton');
            const sidebarNav = document.getElementById('sidebarNav');

            if (loginForm) {
                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const { email, password } = e.target.elements;
                    await this.login(email.value, password.value);
                });
            }
            // ... (adicione listeners para registerForm, showRegister, showLogin, logoutButton, sidebarNav) ...
        },
        
        // -----------------------------------------------------------------------------
        // AÇÕES
        // -----------------------------------------------------------------------------
        async apiRequest(endpoint, method = 'GET', body = null) {
            const headers = { 'Content-Type': 'application/json' };
            if (this.state.token) {
                headers['Authorization'] = `Bearer ${this.state.token}`;
            }
            const options = { method, headers };
            if (body) {
                options.body = JSON.stringify(body);
            }
            try {
                const response = await fetch(`${this.state.API_BASE_URL}${endpoint}`, options);
                if (response.status === 204) return null;
                const data = await response.json();
                if (!response.ok) throw new Error(data.message || 'Erro desconhecido');
                return data;
            } catch (error) {
                alert(`Erro: ${error.message}`);
                throw error;
            }
        },

        async login(email, password) {
            try {
                const data = await this.apiRequest('/api/sellers/login', 'POST', { email, password });
                this.state.token = data.token;
                localStorage.setItem('hottrack_token', data.token);
                await this.init();
            } catch (e) {
                console.error("Falha no login", e);
            }
        },

        logout() {
            this.state.token = null;
            this.state.user = null;
            this.state.data = {};
            localStorage.removeItem('hottrack_token');
            this.render();
        },

        navigateTo(page) {
            this.state.currentPage = page;
            const contentContainer = document.getElementById('content');
            if (contentContainer && this.templates[page]) {
                contentContainer.innerHTML = this.templates[page]();
                document.querySelectorAll('.sidebar-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.target === page);
                });
                // Adicionar listeners específicos da página aqui, se necessário
            }
        }
    };

    App.init();
    </script>
</body>
</html>
